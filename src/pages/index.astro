---
export const prerender = false;

import heroDefault from "../content/hero.json";
import ctaDefault from "../content/cta.json";

const env = Astro.locals?.runtime?.env ?? {};

async function readKVOrDefault(key, fallback) {
  // If KV not bound, fallback
  if (!env.CONTENT_KV) return fallback;

  const raw = await env.CONTENT_KV.get(`${key}.json`);
  if (!raw) return fallback;

  try {
    return JSON.parse(raw);
  } catch {
    return fallback;
  }
}

const hero = await readKVOrDefault("hero", heroDefault);
const cta  = await readKVOrDefault("cta", ctaDefault);
---

<main class="max-w-4xl mx-auto p-8">
  <section class="py-10">
    <h1 class="text-4xl font-bold">{hero.title}</h1>
    <p class="mt-3 text-lg text-gray-600">{hero.subtitle}</p>
    <a
      class="inline-block mt-6 px-4 py-2 rounded bg-black text-white"
      href={hero.cta?.href}
    >
      {hero.cta?.label}
    </a>
  </section>

  <section class="py-10 border-t">
    <h2 class="text-2xl font-semibold">{cta.heading}</h2>
    <p class="mt-2 text-gray-600">{cta.description}</p>
    <a
      class="inline-block mt-5 px-4 py-2 rounded border"
      href={cta.button?.href}
    >
      {cta.button?.label}
    </a>
  </section>
</main>